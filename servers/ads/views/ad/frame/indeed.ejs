<% 
  if(!mobile) {
    width = Math.min(Math.max(300, width), 500)
    height = Math.min(Math.max(370, height), 450)
  }    
%>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
      html, body {
        background: transparent;
        padding: 0;
        margin: 0;
        overflow: hidden;
        font-family: "Arial";
      }
      
      a {
        text-decoration: none;
      }
      
      .hidden {
        display: none;
      }
      
      .container {
        position: relative;
        width: 100%;
        height: <%- height - 25 %>px;
        color: black;
        text-decoration: none;
        display: inline-block;
        border-radius: 4px;
        border: solid 1px #E6E6E6;
        overflow: hidden;
        box-sizing: border-box;
        margin: 0;
        padding: 0;
        background: white;
        padding-bottom: 50px;
      }
      
      .top {
        background: white;
        width: 100%;
        height: 50px;
        box-sizing: border-box;
        font-size: 12px;
        position: absolute;
        z-index: 3;
        top: 0;
        box-sizing: border-box;
        text-align: right;
        color: #657786;
        box-shadow: 3px 0 10px 2px rgba(0,0,0,0.1);
      }
      
      .top .search {
        margin: 8px 0 0 8px;
        width: 178px;
        padding: 8px 8px 8px 26px;
        float: left; 
        font-size: 14px;
        border: solid 1px rgba(0,0,0,0.1);
        border-radius: 4px;
        outline: none;
        background-size: 11px;
        background-repeat: no-repeat;
        background-position: 8px center;
        background-image: url("/public/search.png");
      }
      
      .top .search:hover, .top .search:focus {
        border-color: #37A0F3;
      }
      
      .top .logo-container {
        float: right;
        margin: 16px 10px 0 0;
      }
      
      .top .logo {
        width: 50px;
        height: 15px;
        margin-left: 2px;
        margin-bottom: -2px;
        background-image: url("/public/indeed.png");
        background-position: left center;
        background-repeat: no-repeat;
        background-size: contain;
        display: inline-block;
      }
      
      .listing {
        width: 100%;
        height: <%- height - 75 %>px;
        overflow-x: hidden;
        overflow-y: scroll;
        margin-top: 50px;
        position: relative;
        z-index: 1;
      }
      
      .listing .loading {
        position: absolute;
        width: 100%;
        text-align: center;
        top: 25px;
        font-size: 20px;
        font-weight: lighter;
        color: #455a6d;
        
      }
      
      .item {
        position: relative;
        width: 100%;
        padding: 8px;
        font-size: 14px;
        box-sizing: border-box;
        border-top: solid 1px #f3f3f3;
        display: block;
        background: white;
      }
      
      .item:hover {
        background: #f7f7ff;
      }
      
      .item:first-child {
        border: none;
      }
      
      .item .title {
        font-size: 15px;
        font-weight: bold;
        color: #0000CC; 
        margin-bottom: 2px;
      }
      
      .item .location {
        font-size: 13px;
        font-weight: lighter;
        color: #666;
        margin-bottom: 5px;
      }
      
      .item .description {
        font-size: 13px;
        color: black;
        margin-bottom: 3px;
        line-height: 17px;
      }
      
      .item .posted_at {
        font-size: 12px;
        color: #c3c3c3;
      }
      
      .shortcuts {
        width: 100%;
        height: <%- height - 75 %>px;
        overflow-x: hidden;
        overflow-y: scroll;
        top: 50px;
        position: absolute;
        z-index: 2;
        padding: 20px 5px;
        box-sizing: border-box;
        text-align: center;
        background: white;
      }
      
      .shortcuts img {
        width: 80%;
        display: block;
        text-align: left;
        margin: 0 0 10px 30px;
      }
      
      .shortcuts .shortcut {
        padding: 5px;
        background: #f7f7ff;
        text-align: center;
        border-radius: 4px;
        display: inline-block;
        margin: 4px 2px;
        border: solid 1px rgba(0,0,0,0.05);
        cursor: pointer;
        color: rgba(0,0,0,0.8);
        font-size: 14px;
      }
      
      .shortcuts .shortcut:hover {
        border: solid 1px rgba(0,0,0,0.3);
      }
      
      
      body.mobile .top {
        height: 56px;
      }
      
      body.mobile .top input {
        width: 245px;
        font-size: 16px;
        padding: 10px 10px 10px 35px;
        background-size: 15px;
        background-position: 10px center;
        border-color: #37A0F3;
      }
      
      body.mobile .top .logo-container {
        font-size: 14px;
        margin-top: 21px;
      }
      
      
      body.mobile footer {
        display: none;
      }
      
      body.mobile .container {
        width: 100%;
        height: 100%;
        border: none;
        border-radius: 0;
        padding-bottom: 0;
      }
      
      body.mobile .listing {
        margin-top: 56px;
      }
      
      body.mobile .shortcuts {
        top: 56px;
      }
      
      body.mobile .listing,
      body.mobile .shortcuts {
        height: <%- height - 56 %>px;
        -webkit-overflow-scrolling: touch;
      }
      
      body.mobile .shortcut {
        font-size: 18px;
        padding: 8px;
        margin: 5px 3px;
      }
      
      body.mobile .item {
        padding: 12px;
      }
      
      body.mobile .item .title {
        font-size: 17px;
      }
      
      body.mobile .item .location,
      body.mobile .item .description {
        font-size: 15px;
      }
      
      body.mobile .item .posted_at {
        font-size: 14px;
      }
    </style>
  </head>
  <body class="<%= mobile ? "mobile" : "" %>">
    <div class="container">
      <div class="top">
        <input class="search" type="text" value="<%= creative.config.search %>" placeholder="Search by job title..."/>
        <div class="logo-container">
          jobs by <span class="logo"></span>
        </div>
      </div>
      <div class="listing">
        <div class="loading">loading jobs, hold tight...</div>
        <div class="list"></div>
      </div>
      <div class="shortcuts">
        <img src="/public/indeed-search.jpg"/>
        <div class="shortcut" data-query=" ">Local Jobs</div>
        <div class="shortcut">Public Services</div>
        <div class="shortcut">Sports</div>
        <div class="shortcut" data-query="java python ruby javascript">Software</div>
        <div class="shortcut">Accounting</div>
        <div class="shortcut">UX Designer</div>
        <div class="shortcut">Marketing</div>
        <div class="shortcut">Banking</div>
        <div class="shortcut">Construction</div>
        <div class="shortcut">Mechanical Engineering</div>
        <div class="shortcut">Finance</div>
        <div class="shortcut">Retail</div>
        <div class="shortcut">Healthcare</div>
        <div class="shortcut">Driver</div>
        <div class="shortcut">Law</div>
        <div class="shortcut">Security</div>
        <div class="shortcut">Law Enforcement</div>
        <div class="shortcut" data-query="human resources">HR</div>
        <div class="shortcut">Transportation</div>
        <div class="shortcut">Science</div>
        <div class="shortcut">Sales</div>
        <div class="shortcut">Pharmaceutical</div>
        <div class="shortcut">Recruiting</div>
      </div>
    </div>
    <script src="//code.jquery.com/jquery-3.1.0.min.js"></script>
    <script>
      var last_query = null
      
      $(function() {
        $(".search").keyup(function() { 
          query = $(this).val()
          
          if(query.length == 0) {
            $(".listing .list").html("")
            $(".shortcuts").show().scrollTop(0)
            last_query = null
            return false
          }
          
          search(query);
        })
        
        $(".shortcut").click(function() {
          query = $(this).data("query") || $(this).text().toLowerCase()
          query = query.trim()
          
          $(".search").val($(this).text())
          $(".listing .list").html("")
          $(".shortcuts").hide()
          search(query)
        })        
      })
      
      function search(query) {
        last_query = query
        
        $.get("/indeed", {
          value: query,
          protected: <%- is_protected %>,
          demo: <%- demo %>
        }).done(function(response) {            
          if(response.query != last_query) {
            return false
          }
          
          $(".shortcuts").toggle(response.results.length == 0).scrollTop(0)
          
          $(".listing .list").html("").html(response.results.map(function(job) {
            return $([
              '<a class="item" onmousedown="' + job.mousedown + '" target="_blank" href="' + job.url + '">',
              '<div class="title">' + job.title + '</div>',
              '<div class="location">' + job.location + '</div>',
              '<div class="description">' + job.description + '</div>',
              '<div class="posted_at">' + job.posted_at + '</div>',
              '</a>'
            ].join(""))
          }))
          
          $("a").click(function() {
            $("body").append("<img class='hidden' src='/<%= creative.click_link(publisher.id, null, is_protected, demo) %>'/>")
          })
        })
      }
      
      function indeed_clk(a,sig) { 
        var hr = a.href; var si = hr.indexOf('&jsa='); 
        if (si > 0) return; var jsh = hr + '&jsa=' + sig; 
        if ( jsh.indexOf('&inchal') == -1 ) jsh += '&inchal=apiresults'; a.href = jsh; }
        function init(){(new Image()).src=document.location.protocol+'//gdc.indeed.com/rpc/apilog?a=apiresults';}
        if (window.addEventListener){window.addEventListener('load', init, false);}
        else if (window.attachEvent){window.attachEvent('onload', init);  
      }
    </script>
    <% include ./includes/footer %>
  </body>
</html>