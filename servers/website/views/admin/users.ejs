<% include ../includes/start %>
<% include ../includes/header %>
<% 
  admins_only = users.filter(function(user) {
    return user.is_admin
  }).length
  
  users_only = users.filter(function(user) {
    return !user.is_admin
  }).length
  
  cards_entered = users.filter(function(user) {
    return !!user.stripe_card
  }).length
%>
<div class="container form-table users">
  <div class="stats">
    <span class="active" data-filter="all">
      <strong>All</strong>
      (<%= users.length %>)
    </span>
    <span data-filter="user">
      <strong>Users</strong>
      (<%= users_only %>)
    </span>
    <span data-filter="admin">
      <strong>Admins</strong>
      (<%= admins_only %>)
    </span>
    <span data-filter="card">
      <strong>Cards Entered</strong>
      (<%= cards_entered %>)
    </span>
  </div>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Email</th>
        <th>Card Info</th>
        <th>Admin Contact</th>
        <th>Access</th>
        <th>Joined</th>
      </tr>
    </thead>
    <tbody>
      <% users.forEach(function(user, i) { %>
        <tr class="
          <%= user.is_admin ? "admin" : "user" %>
          <%= !!user.stripe_card ? "card" : "" %>
        ">
          <td><%= user.name %></td>
          <td><a href="mailto:<%= user.email %>"><%= user.email %></a></td>
          <td class="<%= user.stripe_card ? "green" : "red" %>"><%= user.stripe_card || "No Card" %></td>
          <td><%= user.admin_contact ? user.admin_contact.name : "" %></td>
          <td><%= user.is_admin ? "Admin" : "User" %></td>
          <td><%= moment(user.created_at).format("MMM Do, YYYY") %></td>
        </tr>
      <% }) %>
    </tbody>
  </table>
</div>
<% include ../includes/end %>